<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blackjack: Royal Table</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
/* â”€â”€ Variables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
:root {
  --felt:       #1b5e35;
  --felt-lt:    #246b3e;
  --felt-dk:    #133d22;
  --gold:       #c9a84c;
  --gold-lt:    #e8c97a;
  --gold-dk:    #8a6b1f;
  --card-bg:    #fafaf8;
  --red:        #cc1a1a;
  --ink:        #1a1a2e;
  --text:       #f0e6c8;
  --muted:      #a89060;
  --chip-h:     52px;
}

/* â”€â”€ Reset â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html, body {
  width: 100%; height: 100%; overflow: hidden;
  font-family: 'Inter', sans-serif;
  background: #0a140c;
  color: var(--text);
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOME SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#home {
  position: fixed; inset: 0;
  background:
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='5' height='5'%3E%3Ccircle cx='1' cy='1' r='.6' fill='rgba(0,0,0,.06)'/%3E%3Ccircle cx='3.5' cy='3.5' r='.6' fill='rgba(0,0,0,.06)'/%3E%3C/svg%3E"),
    radial-gradient(ellipse at 50% 38%, #1e6b3a 0%, #0d3a1d 55%, #040c06 100%);
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  z-index: 100;
  animation: fadeIn .6s ease;
}
#home.gone { display: none; }

#particle-canvas {
  position: absolute; inset: 0;
  pointer-events: none;
}

.home-logo {
  text-align: center;
  position: relative; z-index: 2;
  animation: slideUp .7s cubic-bezier(.22,.61,.36,1) both;
}
.home-logo h1 {
  font-family: 'Cinzel', serif;
  font-size: clamp(3rem, 9vw, 7rem);
  font-weight: 900;
  color: var(--gold);
  text-shadow: 0 0 40px rgba(201,168,76,.5), 0 2px 0 var(--gold-dk), 0 4px 16px rgba(0,0,0,.9);
  letter-spacing: .12em;
  line-height: 1;
}
.home-logo .sub {
  font-family: 'Cinzel', serif;
  font-size: clamp(.85rem, 2vw, 1.3rem);
  color: var(--gold-lt);
  letter-spacing: .45em;
  text-transform: uppercase;
  margin-top: .4em;
  opacity: .75;
}
.home-divider {
  width: clamp(120px, 28vw, 280px);
  height: 1px;
  background: linear-gradient(to right, transparent, var(--gold), transparent);
  margin: 1.4rem auto 1.6rem;
}

.mode-wrap {
  display: flex; gap: 1.4rem;
  position: relative; z-index: 2;
  flex-wrap: wrap; justify-content: center;
  animation: slideUp .8s .15s cubic-bezier(.22,.61,.36,1) both;
}
.mode-card {
  background: linear-gradient(145deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
  border: 1px solid rgba(201,168,76,.35);
  border-radius: 18px;
  padding: 1.8rem 2.2rem;
  cursor: pointer;
  text-align: center;
  width: clamp(190px, 24vw, 270px);
  transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease;
  backdrop-filter: blur(12px);
  position: relative; overflow: hidden;
}
.mode-card::before {
  content: '';
  position: absolute; inset: 0;
  background: linear-gradient(145deg, rgba(201,168,76,.1), transparent);
  opacity: 0; transition: opacity .25s;
}
.mode-card:hover::before { opacity: 1; }
.mode-card:hover {
  border-color: var(--gold);
  transform: translateY(-5px);
  box-shadow: 0 16px 48px rgba(0,0,0,.5), 0 0 0 1px rgba(201,168,76,.25);
}
.mode-card:active { transform: translateY(-2px); }
.mode-icon { font-size: 2.4rem; margin-bottom: .65rem; display: block; }
.mode-title { font-family: 'Cinzel', serif; font-size: 1.25rem; font-weight: 700; color: var(--gold); letter-spacing: .05em; }
.mode-desc  { font-size: .78rem; color: var(--muted); margin-top: .45rem; line-height: 1.45; }
.mode-tag {
  display: inline-block; margin-top: .7rem;
  padding: .2rem .65rem; border-radius: 20px;
  font-size: .68rem; font-weight: 600; letter-spacing: .04em; text-transform: uppercase;
}
.tag-classic { background: rgba(201,168,76,.12); color: var(--gold); border: 1px solid rgba(201,168,76,.3); }
.tag-learner { background: rgba(60,160,255,.12); color: #7ec8ff; border: 1px solid rgba(60,160,255,.35); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GAME SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#game {
  position: fixed; inset: 0;
  display: flex; flex-direction: column;
}
#game.gone { display: none; }

/* Casino floor surrounding the table */
#game::before {
  content: '';
  position: absolute; inset: 0;
  background: radial-gradient(ellipse at 50% 80%, #1c0900 0%, #080402 60%, #020100 100%);
  z-index: 0;
}
#game::after { display: none; }

/* â”€â”€ Top Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#topbar {
  display: flex; align-items: center; gap: .6rem;
  padding: .55rem .9rem;
  background: rgba(0,0,0,.45);
  border-bottom: 1px solid rgba(201,168,76,.18);
  position: relative; z-index: 10;
  flex-shrink: 0;
}
#btn-menu {
  font-family: 'Cinzel', serif; font-size: .72rem; font-weight: 700;
  padding: .38rem .75rem;
  border: 1px solid rgba(201,168,76,.4); background: rgba(0,0,0,.4);
  color: var(--gold); border-radius: 7px; cursor: pointer;
  letter-spacing: .05em; white-space: nowrap;
  transition: background .2s, border-color .2s;
}
#btn-menu:hover { background: rgba(201,168,76,.12); border-color: var(--gold); }

#shoe-wrap { flex: 1; display: flex; align-items: center; gap: .45rem; }
#shoe-lbl { font-size: .62rem; color: var(--muted); text-transform: uppercase; letter-spacing: .06em; white-space: nowrap; }
#shoe-track { flex: 1; height: 5px; background: rgba(0,0,0,.45); border-radius: 3px; overflow: hidden; border: 1px solid rgba(255,255,255,.08); }
#shoe-fill { height: 100%; width: 100%; background: linear-gradient(to right, #4ade80, #f59e0b 60%, #ef4444); border-radius: 3px; transition: width .5s ease; }

#balance { font-family: 'Cinzel', serif; font-size: .95rem; color: var(--gold); font-weight: 700; white-space: nowrap; min-width: 72px; text-align: right; }

.tbtn {
  font-size: .72rem; padding: .33rem .6rem;
  border: 1px solid rgba(201,168,76,.25); background: rgba(0,0,0,.3);
  color: var(--muted); border-radius: 7px; cursor: pointer;
  transition: all .2s; white-space: nowrap;
}
.tbtn:hover { color: var(--text); border-color: rgba(201,168,76,.5); background: rgba(201,168,76,.08); }
.tbtn.on { color: var(--gold); border-color: var(--gold); background: rgba(201,168,76,.12); }
.learner-only { display: none; }
/* Learner mode â€” reveal learner-only elements via parent class */
#game.learner .tbtn.learner-only  { display: inline-flex; align-items: center; }
#game.learner .abtn.learner-only  { display: inline-flex; align-items: center; }

/* Learner mode badge */
#learner-badge {
  display: none;
  font-size: .62rem; font-weight: 700; letter-spacing: .08em;
  text-transform: uppercase;
  padding: .22rem .55rem; border-radius: 20px;
  background: rgba(60,160,255,.15); color: #7ec8ff;
  border: 1px solid rgba(60,160,255,.35);
  white-space: nowrap;
}
#game.learner #learner-badge { display: block; }

/* Home description */
.home-desc {
  font-size: clamp(.78rem, 1.6vw, .92rem);
  color: var(--muted);
  text-align: center;
  max-width: 420px;
  line-height: 1.65;
  margin: 0 auto 1.6rem;
  position: relative; z-index: 2;
  animation: slideUp .85s .08s cubic-bezier(.22,.61,.36,1) both;
}
.home-desc strong { color: var(--gold-lt); font-weight: 600; }

/* Hint â€” auto version stays visible a bit longer, has a subtle pulse border */
#hint-panel.auto-hint {
  border-color: rgba(96,165,250,.6);
  box-shadow: 0 0 18px rgba(96,165,250,.15);
}

/* â”€â”€ Table â€” curved felt with wood rail â”€â”€â”€â”€â”€ */
#table {
  flex: 1;
  display: flex; flex-direction: column;
  position: relative; z-index: 1;
  overflow: hidden;
  margin: 0 min(4vw, 24px);
  /* D-shaped table: elliptical top, straight bottom */
  border-radius: 50% 50% 10px 10px / 26% 26% 10px 10px;
  /* Felt background + grain */
  background:
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='5' height='5'%3E%3Ccircle cx='1' cy='1' r='.6' fill='rgba(0,0,0,.06)'/%3E%3Ccircle cx='3.5' cy='3.5' r='.6' fill='rgba(0,0,0,.06)'/%3E%3C/svg%3E"),
    radial-gradient(ellipse at 50% 5%, #2d7a47 0%, #1b5e35 42%, #0f3a20 100%);
  /* Wood rail: layered box-shadows simulate the timber border */
  box-shadow:
    inset 0 2px 6px rgba(255,255,255,.04),   /* inner felt highlight */
    0 0 0  4px #8a5220,                       /* wood highlight */
    0 0 0  8px #6b3810,                       /* wood mid */
    0 0 0 13px #4a2208,                       /* wood dark */
    0 0 0 16px #2a1200,                       /* wood edge */
    0 0 0 17px rgba(0,0,0,.6),               /* shadow gap */
    0 24px 80px rgba(0,0,0,.98);              /* floor shadow */
}

/* â”€â”€ Dealer area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#dealer-area {
  flex: 1;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  padding: .75rem;
  position: relative;
}
.area-lbl {
  font-family: 'Cinzel', serif; font-size: .65rem;
  letter-spacing: .32em; color: rgba(201,168,76,.38);
  text-transform: uppercase; margin-bottom: .45rem;
}
#dealer-cards, .hand-cards {
  display: flex; align-items: center; justify-content: center;
  min-height: 100px;
}
.hval {
  font-family: 'Cinzel', serif; font-size: .85rem;
  color: var(--gold-lt); margin-top: .4rem;
  min-height: 1.1em; text-align: center;
}

/* â”€â”€ Divider â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#divider {
  height: 1px;
  background: linear-gradient(to right, transparent, rgba(201,168,76,.28) 20%, rgba(201,168,76,.45) 50%, rgba(201,168,76,.28) 80%, transparent);
  position: relative; flex-shrink: 0;
}
#divider::after {
  content: 'â™   â™¥  â™¦  â™£';
  position: absolute; left: 50%; transform: translateX(-50%);
  top: -.65em; font-size: .65rem;
  color: rgba(201,168,76,.32); letter-spacing: .55em;
  background: #175230; padding: 0 .5rem; /* mid-felt tone, matches gradient centre */
}

/* â”€â”€ Player area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#player-area {
  flex: 1;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  padding: .4rem 1rem;
}
#player-hands {
  display: flex; gap: 1.8rem;
  align-items: flex-start; justify-content: center;
}
.p-hand { display: flex; flex-direction: column; align-items: center; }
.p-hand.active-hand { filter: drop-shadow(0 0 8px rgba(201,168,76,.4)); }
.p-hand.active-hand::after {
  content: 'â–²';
  display: block; text-align: center;
  color: var(--gold); font-size: .55rem;
  margin-top: .25rem;
  animation: blink 1s ease-in-out infinite;
}
.hand-bet { font-size: .68rem; color: var(--muted); margin-top: .2rem; }
.hand-result {
  font-family: 'Cinzel', serif; font-size: .8rem; font-weight: 700;
  margin-top: .3rem; min-height: 1.1em;
}
.hand-result.win      { color: #4ade80; animation: popIn .35s ease; }
.hand-result.lose     { color: #f87171; animation: popIn .35s ease; }
.hand-result.push     { color: #fbbf24; animation: popIn .35s ease; }
.hand-result.blackjack{ color: #ffd700; animation: popIn .35s ease; }
.hand-result.bust     { color: #f87171; animation: popIn .35s ease; }

/* â”€â”€ Count Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#count-panel {
  position: fixed; top: 3.4rem; right: 1.2rem;
  background: rgba(0,0,0,.82);
  border: 1px solid rgba(201,168,76,.28);
  border-radius: 11px; padding: .7rem .9rem;
  min-width: 128px; font-size: .72rem;
  backdrop-filter: blur(14px); z-index: 50;
  animation: fadeIn .25s ease;
}
#count-panel.gone { display: none; }
.crow { display: flex; justify-content: space-between; align-items: center; gap: .8rem; padding: .18rem 0; }
.clbl { color: var(--muted); font-size: .67rem; text-transform: uppercase; letter-spacing: .05em; }
.cval { font-family: 'Cinzel', serif; font-size: .95rem; font-weight: 700; }
.cval.pos { color: #4ade80; }
.cval.neg { color: #f87171; }
.cval.neu { color: var(--gold); }
#count-advice {
  margin-top: .45rem; padding-top: .45rem;
  border-top: 1px solid rgba(255,255,255,.08);
  font-size: .67rem; font-weight: 600; text-align: center;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card {
  width: 66px; height: 96px;
  position: relative; perspective: 700px;
  flex-shrink: 0; margin: 0 -6px;
}
.card-inner {
  width: 100%; height: 100%;
  position: relative;
  transform-style: preserve-3d;
  transition: transform .55s cubic-bezier(.4,0,.2,1);
  border-radius: 8px;
}
.card-inner.flipped { transform: rotateY(180deg); }
.card-face {
  position: absolute; inset: 0;
  border-radius: 8px;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}
/* Back */
.card-back {
  background: #163488;
  background-image:
    repeating-linear-gradient(45deg,  rgba(255,255,255,.035) 0 2px, transparent 2px 9px),
    repeating-linear-gradient(-45deg, rgba(255,255,255,.035) 0 2px, transparent 2px 9px);
  border: 2px solid rgba(255,255,255,.12);
  box-shadow: 2px 3px 10px rgba(0,0,0,.55), inset 0 0 0 5px rgba(255,255,255,.04);
  display: flex; align-items: center; justify-content: center;
}
.card-back::after { content: 'â—†'; font-size: 1.4rem; color: rgba(255,255,255,.12); }

/* Front */
.card-front {
  background: var(--card-bg);
  transform: rotateY(180deg);
  display: flex; flex-direction: column; justify-content: space-between;
  padding: 4px 5px;
  box-shadow: 2px 3px 10px rgba(0,0,0,.45), inset 0 0 0 1px rgba(0,0,0,.08);
}
.card-front.red { color: var(--red); }
.card-front.blk { color: var(--ink); }
.ccorner { display: flex; flex-direction: column; line-height: 1; }
.ccorner.bot { transform: rotate(180deg); align-self: flex-end; }
.crank { font-family: 'Cinzel', serif; font-size: .78rem; font-weight: 700; line-height: 1; }
.csuit-sm { font-size: .6rem; line-height: 1; }
.csuit-ctr { font-size: 1.4rem; line-height: 1; position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); }

/* Card entry animation */
@keyframes slideDown {
  from { opacity: 0; transform: translateY(-90px) scale(.88); }
  to   { opacity: 1; transform: translateY(0)    scale(1);   }
}
.card.deal-anim { animation: slideDown .38s cubic-bezier(.22,.61,.36,1) both; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTION BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#action-bar {
  background: rgba(0,0,0,.52);
  border-top: 1px solid rgba(201,168,76,.18);
  padding: .65rem .9rem;
  position: relative; z-index: 10;
  flex-shrink: 0;
}
.act-sec { display: none; flex-direction: column; gap: .5rem; }
.act-sec.show { display: flex; }
#player-controls { flex-direction: row; flex-wrap: wrap; justify-content: center; gap: .45rem; align-items: center; }
#result-controls  { flex-direction: row; justify-content: center; gap: .9rem; align-items: center; }
#insurance-controls { align-items: center; gap: .5rem; }

/* Chips */
#chip-tray { display: flex; align-items: center; justify-content: center; gap: .45rem; flex-wrap: wrap; }
.chip {
  width: var(--chip-h); height: var(--chip-h);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-family: 'Cinzel', serif; font-size: .63rem; font-weight: 700;
  cursor: pointer; position: relative;
  border: 3px dashed rgba(255,255,255,.22);
  box-shadow: 0 4px 10px rgba(0,0,0,.45), inset 0 2px 0 rgba(255,255,255,.18);
  transition: transform .14s, box-shadow .14s;
}
.chip::before { content: ''; position: absolute; inset: 3px; border-radius: 50%; border: 2px solid rgba(255,255,255,.12); }
.chip:hover { transform: translateY(-3px) scale(1.07); box-shadow: 0 9px 22px rgba(0,0,0,.55); }
.chip:active { transform: translateY(-1px); }
.chip span { position: relative; z-index: 1; letter-spacing: .02em; color: #fff; }
.c5   { background: radial-gradient(circle at 40% 35%, #ff6b6b, #b71c1c); }
.c25  { background: radial-gradient(circle at 40% 35%, #4ade80, #166534); }
.c50  { background: radial-gradient(circle at 40% 35%, #60a5fa, #1e3a8a); }
.c100 { background: radial-gradient(circle at 40% 35%, #9ca3af, #1f2937); }
.c500 { background: radial-gradient(circle at 40% 35%, #c084fc, #6b21a8); }

/* Bet info row */
#bet-row {
  display: flex; align-items: center; justify-content: center; gap: 1.2rem;
}
#bet-display {
  font-family: 'Cinzel', serif; font-size: 1rem; color: var(--gold); text-align: center;
}
#bet-display span { font-size: 1.4rem; font-weight: 700; }

/* Buttons */
.btn {
  font-family: 'Cinzel', serif; font-size: .8rem; font-weight: 700;
  letter-spacing: .05em; padding: .58rem 1.3rem;
  border-radius: 8px; cursor: pointer; border: none;
  transition: transform .18s, box-shadow .18s, opacity .18s;
}
.btn:disabled { opacity: .35; cursor: not-allowed; transform: none !important; }
.btn-gold {
  background: linear-gradient(145deg, var(--gold-lt), var(--gold), var(--gold-dk));
  color: #1a0e00;
  box-shadow: 0 4px 14px rgba(201,168,76,.28);
}
.btn-gold:not(:disabled):hover { transform: translateY(-2px); box-shadow: 0 7px 20px rgba(201,168,76,.38); }
.btn-ghost {
  background: transparent;
  border: 1px solid rgba(201,168,76,.35); color: var(--muted);
}
.btn-ghost:hover { border-color: var(--gold); color: var(--text); background: rgba(201,168,76,.06); }

/* Action buttons */
.abtn {
  font-family: 'Cinzel', serif; font-size: .77rem; font-weight: 700;
  letter-spacing: .05em; padding: .6rem 1.1rem;
  border-radius: 8px; cursor: pointer; border: 1px solid;
  transition: all .18s;
}
.abtn:disabled { opacity: .32; cursor: not-allowed; }
.abtn-hit    { background: rgba(74,222,128,.14); border-color: #4ade80; color: #4ade80; }
.abtn-stand  { background: rgba(248,113,113,.14); border-color: #f87171; color: #f87171; }
.abtn-double { background: rgba(251,191,36,.14);  border-color: #fbbf24; color: #fbbf24; }
.abtn-split  { background: rgba(167,139,250,.14); border-color: #a78bfa; color: #a78bfa; }
.abtn-hint   { background: rgba(96,165,250,.14);  border-color: #60a5fa; color: #60a5fa; }
.abtn-hit:not(:disabled):hover    { background: rgba(74,222,128,.25);  box-shadow: 0 0 14px rgba(74,222,128,.2); }
.abtn-stand:not(:disabled):hover  { background: rgba(248,113,113,.25); box-shadow: 0 0 14px rgba(248,113,113,.2); }
.abtn-double:not(:disabled):hover { background: rgba(251,191,36,.25);  box-shadow: 0 0 14px rgba(251,191,36,.2); }
.abtn-split:not(:disabled):hover  { background: rgba(167,139,250,.25); box-shadow: 0 0 14px rgba(167,139,250,.2); }
.abtn-hint:not(:disabled):hover   { background: rgba(96,165,250,.25); }

/* Insurance */
#ins-q { font-family: 'Cinzel', serif; font-size: .88rem; color: var(--gold); text-align: center; }
.ins-btns { display: flex; gap: .8rem; justify-content: center; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   OVERLAYS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.overlay {
  position: fixed; inset: 0;
  background: rgba(0,0,0,.76);
  z-index: 200;
  display: flex; align-items: center; justify-content: center;
  animation: fadeIn .2s ease;
}
.overlay.gone { display: none; }
.ov-panel {
  background: linear-gradient(145deg, #1a2e1f, #0d1a10);
  border: 1px solid rgba(201,168,76,.28);
  border-radius: 18px; padding: 2rem;
  max-width: min(92vw, 490px);
  max-height: 82vh; overflow-y: auto;
  box-shadow: 0 24px 64px rgba(0,0,0,.85);
}
.ov-title { font-family: 'Cinzel', serif; font-size: 1.15rem; color: var(--gold); margin-bottom: 1.4rem; text-align: center; letter-spacing: .06em; }
.rule { margin-bottom: .9rem; }
.rule h3 { font-size: .75rem; font-weight: 600; color: var(--gold-lt); text-transform: uppercase; letter-spacing: .06em; margin-bottom: .28rem; }
.rule p  { font-size: .78rem; color: var(--muted); line-height: 1.58; }
.ov-close { display: block; width: 100%; margin-top: 1.4rem; }

/* Hint panel */
#hint-panel {
  position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%);
  background: rgba(5,15,8,.93);
  border: 1px solid #60a5fa;
  border-radius: 13px; padding: .9rem 1.4rem;
  max-width: 300px; width: 90%;
  z-index: 150; text-align: center;
}
#hint-panel.gone { display: none; }
#hint-panel.show { animation: hintPop .3s ease both; }
#hint-action { font-family: 'Cinzel', serif; font-size: 1.05rem; font-weight: 700; color: #60a5fa; margin-bottom: .4rem; }
#hint-exp { font-size: .76rem; color: var(--muted); line-height: 1.5; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ANIMATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@keyframes fadeIn  { from { opacity: 0; } to { opacity: 1; } }
@keyframes slideUp { from { opacity: 0; transform: translateY(28px); } to { opacity: 1; transform: translateY(0); } }
@keyframes popIn   { from { opacity: 0; transform: scale(.6); } 60% { transform: scale(1.18); } to { opacity: 1; transform: scale(1); } }
@keyframes hintPop { from { opacity: 0; transform: translateX(-50%) scale(.75); } to { opacity: 1; transform: translateX(-50%) scale(1); } }
@keyframes blink   { 0%, 100% { opacity: 1; } 50% { opacity: .25; } }

/* â”€â”€ Scrollbar â”€â”€ */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: rgba(255,255,255,.04); }
::-webkit-scrollbar-thumb { background: var(--gold-dk); border-radius: 2px; }

/* â”€â”€ Responsive â”€â”€ */
@media (max-width: 420px) {
  .chip { --chip-h: 44px; font-size: .58rem; }
  .card { width: 56px; height: 82px; }
  .crank { font-size: .68rem; }
  .csuit-ctr { font-size: 1.15rem; }
  .abtn { padding: .52rem .8rem; font-size: .72rem; }
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     HOME SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="home">
  <canvas id="particle-canvas"></canvas>
  <div class="home-logo">
    <h1>BLACKJACK</h1>
    <p class="sub">Royal Table</p>
    <div class="home-divider"></div>
  </div>
  <p class="home-desc">
    Beat the dealer by getting closer to <strong>21</strong> without going over.
    Number cards are face value Â· Face cards are <strong>10</strong> Â· Aces are <strong>1 or 11</strong>.
    Get an Ace + 10-value card on your first two cards and you've hit <strong>Blackjack</strong> â€” pays 3:2.
  </p>
  <div class="mode-wrap">
    <div class="mode-card" onclick="startGame('classic')">
      <span class="mode-icon">ğŸƒ</span>
      <div class="mode-title">Classic</div>
      <div class="mode-desc">Standard blackjack. Pure play, no distractions.</div>
      <span class="mode-tag tag-classic">$500 Buy-In</span>
    </div>
    <div class="mode-card" onclick="startGame('learner')">
      <span class="mode-icon">ğŸ“</span>
      <div class="mode-title">Learner</div>
      <div class="mode-desc">Hints, basic strategy, and card counting overlay.</div>
      <span class="mode-tag tag-learner">Training Mode</span>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     GAME SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="game" class="gone">

  <!-- Top Bar -->
  <div id="topbar">
    <button id="btn-menu" onclick="goHome()">â‰¡ Menu</button>
    <div id="shoe-wrap">
      <span id="shoe-lbl">Shoe</span>
      <div id="shoe-track"><div id="shoe-fill"></div></div>
    </div>
    <div id="balance">$500</div>
    <span id="learner-badge">ğŸ“ Learner</span>
    <button class="tbtn learner-only" id="btn-rules" onclick="toggleRules()">ğŸ“– Rules</button>
    <button class="tbtn learner-only" id="btn-count" onclick="toggleCount()">ğŸ”¢ Count</button>
  </div>

  <!-- Table -->
  <div id="table">

    <!-- Dealer -->
    <div id="dealer-area">
      <div class="area-lbl">Dealer</div>
      <div id="dealer-cards"></div>
      <div id="dealer-val" class="hval"></div>
    </div>

    <!-- Count panel -->
    <div id="count-panel" class="gone">
      <div class="crow"><span class="clbl">Running</span><span class="cval neu" id="rc">0</span></div>
      <div class="crow"><span class="clbl">True</span><span class="cval neu" id="tc">0.0</span></div>
      <div class="crow"><span class="clbl">Decks Left</span><span class="cval neu" id="dl">6.0</span></div>
      <div id="count-advice" style="color:var(--gold)">Neutral</div>
    </div>

    <!-- Divider -->
    <div id="divider"></div>

    <!-- Player -->
    <div id="player-area">
      <div class="area-lbl">Player</div>
      <div id="player-hands"></div>
    </div>
  </div>

  <!-- Action Bar -->
  <div id="action-bar">

    <!-- BETTING -->
    <div class="act-sec" id="betting-controls">
      <div id="chip-tray">
        <div class="chip c5"   onclick="addChip(5)"  ><span>$5</span></div>
        <div class="chip c25"  onclick="addChip(25)" ><span>$25</span></div>
        <div class="chip c50"  onclick="addChip(50)" ><span>$50</span></div>
        <div class="chip c100" onclick="addChip(100)"><span>$100</span></div>
        <div class="chip c500" onclick="addChip(500)"><span>$500</span></div>
      </div>
      <div id="bet-row">
        <button class="btn btn-ghost" onclick="clearBet()">Clear</button>
        <div id="bet-display">Bet: <span id="bet-amt">$0</span></div>
        <button class="btn btn-gold" id="btn-deal" onclick="deal()" disabled>Deal</button>
      </div>
    </div>

    <!-- INSURANCE -->
    <div class="act-sec" id="insurance-controls">
      <div id="ins-q">Dealer shows Ace â€” Take Insurance? (costs <span id="ins-cost">$0</span>)</div>
      <div class="ins-btns">
        <button class="btn btn-gold"  onclick="takeInsurance(true)">Yes â€” Insure</button>
        <button class="btn btn-ghost" onclick="takeInsurance(false)">No Thanks</button>
      </div>
    </div>

    <!-- PLAYER ACTIONS -->
    <div class="act-sec" id="player-controls">
      <button class="abtn abtn-hint learner-only" id="btn-hint" onclick="showHint()">ğŸ’¡ Hint</button>
      <button class="abtn abtn-hit"    id="btn-hit"    onclick="playerHit()">Hit</button>
      <button class="abtn abtn-stand"  id="btn-stand"  onclick="playerStand()">Stand</button>
      <button class="abtn abtn-double" id="btn-double" onclick="playerDouble()">Double</button>
      <button class="abtn abtn-split"  id="btn-split"  onclick="playerSplit()">Split</button>
    </div>

    <!-- RESULT -->
    <div class="act-sec" id="result-controls">
      <button class="btn btn-ghost" id="btn-rebuy" onclick="rebuy()" style="display:none">Rebuy $500</button>
      <button class="btn btn-gold" onclick="newHand()">New Hand</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     RULES OVERLAY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="overlay gone" id="rules-overlay">
  <div class="ov-panel">
    <div class="ov-title">ğŸ“– Blackjack Rules</div>
    <div class="rule"><h3>Hit</h3><p>Take another card from the dealer to increase your hand total.</p></div>
    <div class="rule"><h3>Stand</h3><p>Keep your current hand and end your turn.</p></div>
    <div class="rule"><h3>Double Down</h3><p>Double your bet and receive exactly one more card. Available on your first two cards only.</p></div>
    <div class="rule"><h3>Split</h3><p>When dealt a pair, split into two separate hands â€” each gets a new card and an equal bet. Split Aces receive one card each only.</p></div>
    <div class="rule"><h3>Insurance</h3><p>When the dealer shows an Ace, bet up to half your original bet that the dealer has blackjack. Pays 2:1 if correct.</p></div>
    <div class="rule"><h3>Blackjack</h3><p>Ace + any 10-value card on your first two cards. Pays 3:2. Ties with dealer blackjack push (no win/loss).</p></div>
    <div class="rule"><h3>Card Counting (Hi-Lo)</h3><p>2â€“6 = +1 (good cards remain). 7â€“9 = 0 (neutral). 10â€“Ace = âˆ’1. A high true count favours you.</p></div>
    <div class="rule"><h3>Shoe &amp; Shuffle</h3><p>6 decks (312 cards). Reshuffled automatically when roughly 25% or fewer cards remain.</p></div>
    <button class="btn btn-ghost ov-close" onclick="toggleRules()">Close</button>
  </div>
</div>

<!-- Hint panel -->
<div id="hint-panel" class="gone">
  <div id="hint-action">Stand</div>
  <div id="hint-exp">Basic strategy recommends standing here.</div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONSTANTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const SUITS = ['â™ ','â™¥','â™¦','â™£'];
const RANKS = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
const RED   = new Set(['â™¥','â™¦']);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const G = {
  mode:        'classic',
  phase:       'home',    // home|betting|dealing|insurance|player|dealer|result
  shoe:        [],
  runCount:    0,
  balance:     500,
  bet:         0,
  hands:       [],        // [{cards, bet, doubled, splitAce, result, done}]
  activeIdx:   0,
  dealerCards: [],
  insBet:      0,
  showCount:   false,
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHOE & CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function faceValue(rank) {
  if (rank === 'A') return 11;
  if (['J','Q','K'].includes(rank)) return 10;
  return parseInt(rank);
}

function hiLo(rank) {
  if (['2','3','4','5','6'].includes(rank)) return  1;
  if (['7','8','9'].includes(rank))         return  0;
  return -1;
}

function buildShoe() {
  const deck = [];
  for (let d = 0; d < 6; d++)
    for (const suit of SUITS)
      for (const rank of RANKS)
        deck.push({ suit, rank, val: faceValue(rank), hl: hiLo(rank) });
  // Fisher-Yates
  for (let i = deck.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [deck[i], deck[j]] = [deck[j], deck[i]];
  }
  return deck;
}

function reshuffle() {
  G.shoe     = buildShoe();
  G.runCount = 0;
  updateCountUI();
  updateShoeUI();
  // Flash shoe bar
  const f = $('shoe-fill');
  f.style.transition = 'none';
  f.style.width = '100%';
  setTimeout(() => { f.style.transition = ''; }, 60);
}

function drawCard() {
  if (G.shoe.length < 52) reshuffle();
  const c = G.shoe.pop();
  G.runCount += c.hl;
  updateShoeUI();
  updateCountUI();
  return c;
}

function decksLeft() {
  return Math.max(G.shoe.length / 52, 0.5);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HAND VALUE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function handVal(cards) {
  let total = 0, aces = 0;
  for (const c of cards) { total += c.val; if (c.rank === 'A') aces++; }
  while (total > 21 && aces > 0) { total -= 10; aces--; }
  return total;
}

function isSoft(cards) {
  const hard = cards.reduce((s, c) => s + (c.rank === 'A' ? 1 : c.val), 0);
  return handVal(cards) > hard;
}

function isBJ(cards)   { return cards.length === 2 && handVal(cards) === 21; }
function isPair(cards) { return cards.length === 2 && cards[0].rank === cards[1].rank; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BASIC STRATEGY ENGINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function basicStrategy(playerCards, dealerUp) {
  const pv = handVal(playerCards);
  const dv = Math.min(dealerUp.val, 10); // cap at 10 for 10/J/Q/K; Ace = 11
  const dr = dealerUp.rank === 'A' ? 11 : dv;

  // â”€â”€ Pair splitting â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (isPair(playerCards)) {
    const r = playerCards[0].rank;
    if (r === 'A' || r === '8')
      return { action: 'Split', why: `Always split ${r === 'A' ? 'Aces' : '8s'}.` };
    if (['10','J','Q','K'].includes(r))
      return { action: 'Stand', why: 'Never split 10-value pairs â€” 20 is a powerful hand.' };
    if (r === '5')
      return dr <= 9 && playerCards.length === 2
        ? { action: 'Double', why: 'Treat 5-5 as 10; double against dealer 2â€“9.' }
        : { action: 'Hit',    why: 'Treat 5-5 as 10; hit.' };
    if (r === '9') {
      if ([7, 10, 11].includes(dr))
        return { action: 'Stand', why: 'Stand on 9-9 vs dealer 7, 10, or Ace.' };
      return { action: 'Split', why: 'Split 9s vs dealer 2â€“6, 8â€“9.' };
    }
    if (r === '7') return dr <= 7
      ? { action: 'Split', why: 'Split 7s vs dealer 2â€“7.' }
      : { action: 'Hit',   why: 'Hit 7-7 vs dealer 8 or higher.' };
    if (r === '6') return dr <= 6
      ? { action: 'Split', why: 'Split 6s vs dealer 2â€“6.' }
      : { action: 'Hit',   why: 'Hit 6-6 vs dealer 7 or higher.' };
    if (r === '4') return (dr === 5 || dr === 6)
      ? { action: 'Split', why: 'Split 4s vs dealer 5â€“6 only.' }
      : { action: 'Hit',   why: 'Treat 4-4 as 8; hit.' };
    if (r === '2' || r === '3') return dr <= 7
      ? { action: 'Split', why: `Split ${r}s vs dealer 2â€“7.` }
      : { action: 'Hit',   why: `Hit ${r}-${r} vs dealer 8 or higher.` };
  }

  // â”€â”€ Soft hands â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (isSoft(playerCards) && playerCards.some(c => c.rank === 'A')) {
    if (pv >= 19) return { action: 'Stand', why: 'Stand on soft 19 or better.' };
    if (pv === 18) {
      if (dr <= 6 && playerCards.length === 2)
        return { action: 'Double', why: 'Double soft 18 vs dealer 2â€“6.' };
      if (dr <= 8)
        return { action: 'Stand', why: 'Stand on soft 18 vs dealer 7â€“8.' };
      return { action: 'Hit', why: 'Hit soft 18 vs dealer 9, 10, or Ace.' };
    }
    if (pv === 17) {
      if ([3,4,5,6].includes(dr) && playerCards.length === 2)
        return { action: 'Double', why: 'Double soft 17 vs dealer 3â€“6.' };
      return { action: 'Hit', why: 'Hit soft 17.' };
    }
    if (pv === 15 || pv === 16) {
      if ([4,5,6].includes(dr) && playerCards.length === 2)
        return { action: 'Double', why: `Double soft ${pv} vs dealer 4â€“6.` };
      return { action: 'Hit', why: `Hit soft ${pv}.` };
    }
    if (pv === 13 || pv === 14) {
      if ([5,6].includes(dr) && playerCards.length === 2)
        return { action: 'Double', why: `Double soft ${pv} vs dealer 5â€“6.` };
      return { action: 'Hit', why: `Hit soft ${pv}.` };
    }
    return { action: 'Hit', why: 'Hit â€” soft total too low.' };
  }

  // â”€â”€ Hard hands â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (pv >= 17) return { action: 'Stand', why: 'Stand on hard 17 or higher.' };
  if (pv >= 13) {
    if (dr <= 6) return { action: 'Stand', why: `Stand on ${pv} â€” dealer likely to bust showing ${dealerUp.rank}.` };
    return { action: 'Hit', why: `Hit hard ${pv} vs dealer ${dealerUp.rank}.` };
  }
  if (pv === 12) {
    if (dr >= 4 && dr <= 6) return { action: 'Stand', why: 'Stand on 12 vs dealer 4â€“6.' };
    return { action: 'Hit', why: 'Hit hard 12 vs dealer 2, 3, or 7+.' };
  }
  if (pv === 11) {
    if (playerCards.length === 2) return { action: 'Double', why: 'Double on 11 â€” prime doubling opportunity.' };
    return { action: 'Hit', why: 'Hit 11 (3+ cards â€” can\'t double).' };
  }
  if (pv === 10) {
    if (dr <= 9 && playerCards.length === 2) return { action: 'Double', why: 'Double on 10 vs dealer 2â€“9.' };
    return { action: 'Hit', why: 'Hit hard 10.' };
  }
  if (pv === 9) {
    if ([3,4,5,6].includes(dr) && playerCards.length === 2)
      return { action: 'Double', why: 'Double on 9 vs dealer 3â€“6.' };
    return { action: 'Hit', why: 'Hit hard 9.' };
  }
  return { action: 'Hit', why: `Hit hard ${pv} â€” total too low to stand.` };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UI HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const $ = id => document.getElementById(id);

function setPhase(p) {
  G.phase = p;
  document.querySelectorAll('.act-sec').forEach(el => el.classList.remove('show'));
  const map = { betting:'betting-controls', insurance:'insurance-controls', player:'player-controls', result:'result-controls' };
  if (map[p]) $(map[p]).classList.add('show');
  if (p !== 'player') { $('hint-panel').classList.add('gone'); $('hint-panel').classList.remove('show'); }
}

function updateBalanceUI() { $('balance').textContent = '$' + G.balance.toLocaleString(); }

function updateBetUI() {
  $('bet-amt').textContent = '$' + G.bet;
  $('btn-deal').disabled = G.bet === 0 || G.bet > G.balance;
}

function updateShoeUI() {
  $('shoe-fill').style.width = ((G.shoe.length / 312) * 100) + '%';
}

function updateCountUI() {
  if (!G.showCount) return;
  const d   = decksLeft();
  const tc  = (G.runCount / d);
  const rcS = (G.runCount >= 0 ? '+' : '') + G.runCount;
  const tcS = (tc >= 0 ? '+' : '') + tc.toFixed(1);
  $('rc').textContent = rcS;
  $('tc').textContent = tcS;
  $('dl').textContent = d.toFixed(1);
  const cls = tc > 1 ? 'pos' : tc < -1 ? 'neg' : 'neu';
  ['rc','tc','dl'].forEach(id => { $( id).className = 'cval ' + cls; });
  const adv = $('count-advice');
  if (cls === 'pos') { adv.textContent = 'âœ“ Favourable â€” bet more';  adv.style.color = '#4ade80'; }
  else if (cls === 'neg') { adv.textContent = 'âœ— Unfavourable â€” bet less'; adv.style.color = '#f87171'; }
  else { adv.textContent = '~ Neutral';  adv.style.color = 'var(--gold)'; }
}

function updateActionBtns() {
  const hand = G.hands[G.activeIdx];
  if (!hand) return;
  const canDbl   = hand.cards.length === 2 && G.balance >= hand.bet && !hand.doubled;
  const canSplit  = hand.cards.length === 2 && isPair(hand.cards) && G.balance >= hand.bet && G.hands.length < 4 && !hand.splitAce;
  const canHit    = !hand.splitAce;
  $('btn-hit').disabled    = !canHit;
  $('btn-double').disabled = !canDbl;
  $('btn-split').disabled  = !canSplit;
  $('btn-stand').disabled  = false;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARD ELEMENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function makeCardEl(card, faceDown) {
  const isRed = RED.has(card.suit);
  const el = document.createElement('div');
  el.className = 'card';
  el.innerHTML = `
    <div class="card-inner${faceDown ? '' : ' flipped'}">
      <div class="card-face card-back"></div>
      <div class="card-face card-front ${isRed ? 'red' : 'blk'}">
        <div class="ccorner top">
          <div class="crank">${card.rank}</div>
          <div class="csuit-sm">${card.suit}</div>
        </div>
        <div class="csuit-ctr">${card.suit}</div>
        <div class="ccorner bot">
          <div class="crank">${card.rank}</div>
          <div class="csuit-sm">${card.suit}</div>
        </div>
      </div>
    </div>`;
  return el;
}

function appendCard(container, card, faceDown, delay, cb) {
  setTimeout(() => {
    const el = makeCardEl(card, faceDown);
    el.classList.add('deal-anim');
    container.appendChild(el);
    el.addEventListener('animationend', () => { el.classList.remove('deal-anim'); if (cb) cb(); }, { once: true });
  }, delay);
}

function flipHoleCard() {
  // dealer card at index 1 is the hole card
  const cards = $('dealer-cards').querySelectorAll('.card');
  if (cards[1]) cards[1].querySelector('.card-inner').classList.add('flipped');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderDealerVal(reveal) {
  const valEl = $('dealer-val');
  if (!reveal && G.dealerCards.length >= 1) {
    const shown = handVal([G.dealerCards[0]]);
    valEl.textContent = G.dealerCards.length >= 2 ? shown + ' + ?' : shown;
  } else {
    const v = handVal(G.dealerCards);
    valEl.textContent = v > 21 ? 'BUST' : v;
    if (v > 21) valEl.style.color = '#f87171';
    else valEl.style.color = '';
  }
}

function renderDealerFull() {
  const cont = $('dealer-cards');
  cont.innerHTML = '';
  // G.dealerCards[0] = upcard (face up), G.dealerCards[1] = hole (face down until revealed)
  G.dealerCards.forEach((c, i) => {
    const el = makeCardEl(c, false); // all face-up (called after reveal)
    cont.appendChild(el);
  });
}

function renderPlayerHands() {
  const cont = $('player-hands');
  cont.innerHTML = '';
  G.hands.forEach((hand, hi) => {
    const handEl = document.createElement('div');
    handEl.className = 'p-hand' + (hi === G.activeIdx && G.phase === 'player' ? ' active-hand' : '');

    const cardsEl = document.createElement('div');
    cardsEl.className = 'hand-cards';
    hand.cards.forEach(c => cardsEl.appendChild(makeCardEl(c, false)));

    const v = handVal(hand.cards);
    const valEl = document.createElement('div');
    valEl.className = 'hval';
    if (isSoft(hand.cards) && v < 21) {
      valEl.textContent = (v - 10) + '/' + v;
    } else {
      valEl.textContent = v > 21 ? 'BUST' : v;
      if (v > 21) valEl.style.color = '#f87171';
    }

    const betEl = document.createElement('div');
    betEl.className = 'hand-bet';
    betEl.textContent = 'Bet: $' + hand.bet + (hand.doubled ? ' Ã—2' : '');

    const resEl = document.createElement('div');
    resEl.className = 'hand-result' + (hand.result ? ' ' + hand.result : '');
    resEl.textContent = hand.result ? resultLabel(hand.result, hand.bet) : '';

    handEl.appendChild(cardsEl);
    handEl.appendChild(valEl);
    handEl.appendChild(betEl);
    handEl.appendChild(resEl);
    cont.appendChild(handEl);
  });
}

function resultLabel(r, bet) {
  switch (r) {
    case 'blackjack': return `Blackjack! +$${Math.floor(bet * 1.5)}`;
    case 'win':  return `Win! +$${bet}`;
    case 'push': return 'Push';
    case 'lose': return `-$${bet}`;
    case 'bust': return `Bust  âˆ’$${bet}`;
    default: return '';
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GAME FLOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function startGame(mode) {
  G.mode      = mode;
  G.balance   = 500;
  G.bet       = 0;
  G.shoe      = buildShoe();
  G.runCount  = 0;
  G.showCount = false;

  $('game').classList.toggle('learner', mode === 'learner');

  $('home').classList.add('gone');
  $('game').classList.remove('gone');
  $('count-panel').classList.add('gone');
  $('btn-count').classList.remove('on');
  $('dealer-cards').innerHTML = '';
  $('player-hands').innerHTML = '';
  $('dealer-val').textContent = '';

  updateBalanceUI();
  updateBetUI();
  updateShoeUI();
  setPhase('betting');
}

function goHome() {
  $('game').classList.add('gone');
  $('home').classList.remove('gone');
}

function addChip(v) {
  if (G.phase !== 'betting') return;
  if (G.bet + v > G.balance) { flashBal(); return; }
  G.bet += v;
  updateBetUI();
}

function flashBal() {
  const el = $('balance');
  el.style.color = '#f87171';
  setTimeout(() => { el.style.color = ''; }, 500);
}

function clearBet() { G.bet = 0; updateBetUI(); }

function deal() {
  if (G.bet === 0 || G.bet > G.balance || G.phase !== 'betting') return;
  if (G.shoe.length <= 78) reshuffle();

  G.balance -= G.bet;
  updateBalanceUI();

  G.hands       = [{ cards: [], bet: G.bet, doubled: false, splitAce: false, result: null, done: false }];
  G.activeIdx   = 0;
  G.dealerCards = [];
  G.insBet      = 0;

  $('dealer-cards').innerHTML = '';
  $('player-hands').innerHTML = '';
  $('dealer-val').textContent = '';

  setPhase('dealing');

  // Staggered deal: P1, D-upcard(face-up), P2, D-hole(face-down)
  const dc = $('dealer-cards');
  const pc = () => $('player-hands').querySelector('.hand-cards') || (() => {
    const h = document.createElement('div'); h.className = 'p-hand';
    const hc = document.createElement('div'); hc.className = 'hand-cards';
    const vl = document.createElement('div'); vl.className = 'hval';
    const bt = document.createElement('div'); bt.className = 'hand-bet';
    const rs = document.createElement('div'); rs.className = 'hand-result';
    h.appendChild(hc); h.appendChild(vl); h.appendChild(bt); h.appendChild(rs);
    $('player-hands').appendChild(h);
    return hc;
  })();

  // Build player hand container first
  const ph = document.createElement('div'); ph.className = 'p-hand';
  const phc = document.createElement('div'); phc.className = 'hand-cards';
  const phv = document.createElement('div'); phv.className = 'hval';
  const phb = document.createElement('div'); phb.className = 'hand-bet';
  const phr = document.createElement('div'); phr.className = 'hand-result';
  ph.appendChild(phc); ph.appendChild(phv); ph.appendChild(phb); ph.appendChild(phr);
  $('player-hands').appendChild(ph);

  const DELAY = 150;

  // Card 1: player
  setTimeout(() => {
    const c = drawCard();
    G.hands[0].cards.push(c);
    appendCard(phc, c, false, 0, () => { phv.textContent = handVal(G.hands[0].cards); phb.textContent = 'Bet: $' + G.bet; });
  }, 0);

  // Card 2: dealer upcard (face up, index 0)
  setTimeout(() => {
    const c = drawCard();
    G.dealerCards.push(c);
    appendCard(dc, c, false, 0, () => renderDealerVal(false));
  }, DELAY);

  // Card 3: player
  setTimeout(() => {
    const c = drawCard();
    G.hands[0].cards.push(c);
    appendCard(phc, c, false, 0, () => {
      const v = handVal(G.hands[0].cards);
      phv.textContent = isSoft(G.hands[0].cards) && v < 21 ? (v-10)+'/'+v : v;
      phb.textContent = 'Bet: $' + G.bet;
    });
  }, DELAY * 2);

  // Card 4: dealer hole card (face DOWN, index 1)
  setTimeout(() => {
    const c = drawCard();
    G.dealerCards.push(c);
    appendCard(dc, c, true, 0, () => renderDealerVal(false));
  }, DELAY * 3);

  // After deal complete
  setTimeout(afterDeal, DELAY * 4 + 150);
}

function afterDeal() {
  const upcard = G.dealerCards[0];
  if (upcard.rank === 'A') {
    // Offer insurance
    $('ins-cost').textContent = '$' + Math.floor(G.bet / 2);
    setPhase('insurance');
  } else {
    checkBJAndContinue();
  }
}

function takeInsurance(yes) {
  if (yes) {
    G.insBet = Math.floor(G.bet / 2);
    G.balance -= G.insBet;
    updateBalanceUI();
  }
  checkBJAndContinue();
}

function checkBJAndContinue() {
  const dealerBJ = isBJ(G.dealerCards);
  const playerBJ = isBJ(G.hands[0].cards);

  if (dealerBJ || playerBJ) {
    // Reveal hole card
    flipHoleCard();
    setTimeout(() => {
      renderDealerVal(true);

      if (dealerBJ && playerBJ) {
        G.hands[0].result = 'push';
        G.balance += G.hands[0].bet;
        // Insurance push (return insurance bet)
        if (G.insBet > 0) G.balance += G.insBet;
      } else if (playerBJ) {
        G.hands[0].result = 'blackjack';
        G.balance += G.hands[0].bet + Math.floor(G.hands[0].bet * 1.5);
      } else {
        // Dealer BJ
        G.hands[0].result = 'lose';
        if (G.insBet > 0) G.balance += G.insBet * 3; // 2:1 pays back 3Ã— stake
      }

      updateBalanceUI();
      renderPlayerHands();
      setPhase('result');
      checkRebuy();
    }, 400);
    return;
  }

  // No BJ â€” insurance bet is lost (already deducted)
  setPhase('player');
  renderPlayerHands();   // re-render so active-hand indicator appears
  updateActionBtns();
  if (G.mode === 'learner') setTimeout(() => showHint(true), 300);
}

/* â”€â”€ Player actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function playerHit() {
  if (G.phase !== 'player') return;
  const hand = G.hands[G.activeIdx];
  if (!hand || hand.splitAce) return;

  const c = drawCard();
  hand.cards.push(c);

  // Animate new card
  const handEls = $('player-hands').querySelectorAll('.p-hand');
  const handEl  = handEls[G.activeIdx];
  if (handEl) {
    const cardsEl = handEl.querySelector('.hand-cards');
    const el = makeCardEl(c, false);
    el.classList.add('deal-anim');
    cardsEl.appendChild(el);
    el.addEventListener('animationend', () => el.classList.remove('deal-anim'), { once: true });
    // Update value display
    const valEl = handEl.querySelector('.hval');
    const v = handVal(hand.cards);
    if (isSoft(hand.cards) && v < 21) valEl.textContent = (v-10)+'/'+v;
    else { valEl.textContent = v > 21 ? 'BUST' : v; valEl.style.color = v > 21 ? '#f87171' : ''; }
  }

  if (handVal(hand.cards) >= 21) {
    setTimeout(advanceHand, 500);
  } else {
    updateActionBtns();
    if (G.mode === 'learner') setTimeout(() => showHint(true), 350);
  }
}

function playerStand() {
  if (G.phase !== 'player') return;
  advanceHand();
}

function playerDouble() {
  if (G.phase !== 'player') return;
  const hand = G.hands[G.activeIdx];
  if (!hand || hand.cards.length !== 2 || G.balance < hand.bet) return;

  G.balance -= hand.bet;
  hand.bet   *= 2;
  hand.doubled = true;
  updateBalanceUI();

  const c = drawCard();
  hand.cards.push(c);

  const handEls = $('player-hands').querySelectorAll('.p-hand');
  const handEl  = handEls[G.activeIdx];
  if (handEl) {
    const cardsEl = handEl.querySelector('.hand-cards');
    const el = makeCardEl(c, false);
    el.classList.add('deal-anim');
    cardsEl.appendChild(el);
    el.addEventListener('animationend', () => el.classList.remove('deal-anim'), { once: true });
    const valEl = handEl.querySelector('.hval');
    const v = handVal(hand.cards);
    valEl.textContent = v > 21 ? 'BUST' : v;
    if (v > 21) valEl.style.color = '#f87171';
    handEl.querySelector('.hand-bet').textContent = 'Bet: $' + hand.bet + ' Ã—2';
  }

  setTimeout(advanceHand, 500);
}

function playerSplit() {
  if (G.phase !== 'player') return;
  const hand = G.hands[G.activeIdx];
  if (!hand || !isPair(hand.cards) || G.balance < hand.bet || G.hands.length >= 4) return;

  G.balance -= hand.bet;
  updateBalanceUI();

  const splitCard = hand.cards.pop();
  const isAceSplit = splitCard.rank === 'A';
  hand.splitAce = isAceSplit;

  const newHand = { cards: [splitCard], bet: hand.bet, doubled: false, splitAce: isAceSplit, result: null, done: false };
  G.hands.splice(G.activeIdx + 1, 0, newHand);

  // Redraw full player area, then animate new cards
  renderPlayerHands();

  setTimeout(() => {
    // Draw card for hand[activeIdx]
    const c1 = drawCard();
    G.hands[G.activeIdx].cards.push(c1);
    const handEls1 = $('player-hands').querySelectorAll('.p-hand');
    const h1 = handEls1[G.activeIdx];
    if (h1) {
      const el = makeCardEl(c1, false);
      el.classList.add('deal-anim');
      h1.querySelector('.hand-cards').appendChild(el);
      el.addEventListener('animationend', () => el.classList.remove('deal-anim'), { once: true });
      const v = handVal(G.hands[G.activeIdx].cards);
      h1.querySelector('.hval').textContent = isSoft(G.hands[G.activeIdx].cards) && v < 21 ? (v-10)+'/'+v : v;
    }

    setTimeout(() => {
      // Draw card for hand[activeIdx+1]
      const c2 = drawCard();
      G.hands[G.activeIdx + 1].cards.push(c2);
      const handEls2 = $('player-hands').querySelectorAll('.p-hand');
      const h2 = handEls2[G.activeIdx + 1];
      if (h2) {
        const el = makeCardEl(c2, false);
        el.classList.add('deal-anim');
        h2.querySelector('.hand-cards').appendChild(el);
        el.addEventListener('animationend', () => el.classList.remove('deal-anim'), { once: true });
        const v = handVal(G.hands[G.activeIdx + 1].cards);
        h2.querySelector('.hval').textContent = isSoft(G.hands[G.activeIdx + 1].cards) && v < 21 ? (v-10)+'/'+v : v;
      }

      if (isAceSplit) {
        // Both hands done â€” go to dealer
        setTimeout(dealerPlay, 400);
      } else {
        updateActionBtns();
        setTimeout(renderPlayerHands, 420); // wait for deal-anim to finish
      }
    }, 350);
  }, 200);
}

function advanceHand() {
  G.hands[G.activeIdx].done = true;

  // Find next undone hand
  let next = -1;
  for (let i = G.activeIdx + 1; i < G.hands.length; i++) {
    if (!G.hands[i].done) { next = i; break; }
  }

  if (next === -1) {
    // All hands done â€” dealer plays
    dealerPlay();
  } else {
    G.activeIdx = next;
    renderPlayerHands();
    updateActionBtns();
    if (G.mode === 'learner') setTimeout(() => showHint(true), 300);
  }
}

/* â”€â”€ Dealer play â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function dealerPlay() {
  setPhase('dealer');
  $('hint-panel').classList.add('gone');
  $('hint-panel').classList.remove('show');

  // Reveal hole card
  flipHoleCard();
  setTimeout(() => {
    renderDealerVal(true);
    dealerDraw();
  }, 600);
}

function dealerDraw() {
  const v = handVal(G.dealerCards);
  if (v < 17) {
    // Draw another card
    const c = drawCard();
    G.dealerCards.push(c);
    appendCard($('dealer-cards'), c, false, 0, () => {
      renderDealerVal(true);
      setTimeout(dealerDraw, 500);
    });
  } else {
    // Dealer stands â€” resolve
    setTimeout(resolveHands, 400);
  }
}

/* â”€â”€ Resolve â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function resolveHands() {
  const dv = handVal(G.dealerCards);
  const dealerBust = dv > 21;

  G.hands.forEach(hand => {
    if (hand.result) return; // already set (e.g., bust during player turn)
    const pv = handVal(hand.cards);
    if (pv > 21) {
      hand.result = 'bust';
      // money already lost
    } else if (dealerBust || pv > dv) {
      hand.result = 'win';
      G.balance += hand.bet * 2;
    } else if (pv === dv) {
      hand.result = 'push';
      G.balance += hand.bet;
    } else {
      hand.result = 'lose';
    }
  });

  updateBalanceUI();
  renderPlayerHands();
  setPhase('result');
  checkRebuy();
}

function checkRebuy() {
  $('btn-rebuy').style.display = G.balance === 0 ? '' : 'none';
}

function rebuy() {
  G.balance += 500;
  updateBalanceUI();
  $('btn-rebuy').style.display = 'none';
}

function newHand() {
  G.bet = 0;
  $('dealer-cards').innerHTML = '';
  $('player-hands').innerHTML = '';
  $('dealer-val').textContent = '';
  $('dealer-val').style.color = '';
  G.hands = [];
  G.dealerCards = [];
  updateBetUI();
  setPhase('betting');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LEARNER FEATURES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showHint(auto = false) {
  if (G.phase !== 'player') return;
  const hand = G.hands[G.activeIdx];
  if (!hand || !G.dealerCards[0]) return;
  const { action, why } = basicStrategy(hand.cards, G.dealerCards[0]);
  $('hint-action').textContent = action;
  $('hint-exp').textContent    = why;
  const hp = $('hint-panel');
  hp.classList.remove('gone', 'show', 'auto-hint');
  void hp.offsetWidth; // reflow for re-animation
  hp.classList.add('show');
  if (auto) hp.classList.add('auto-hint');
  // Auto-hide: manual hint 5s, auto hint 9s
  clearTimeout(G._hintTimer);
  G._hintTimer = setTimeout(() => { hp.classList.remove('show', 'auto-hint'); hp.classList.add('gone'); }, auto ? 9000 : 5000);
}

function toggleRules() {
  $('rules-overlay').classList.toggle('gone');
}

function toggleCount() {
  G.showCount = !G.showCount;
  $('count-panel').classList.toggle('gone', !G.showCount);
  $('btn-count').classList.toggle('on', G.showCount);
  if (G.showCount) updateCountUI();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PARTICLE CANVAS â€” HOME SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
(function initParticles() {
  const canvas = $('particle-canvas');
  const ctx    = canvas.getContext('2d');
  const suits  = ['â™ ','â™¥','â™¦','â™£'];
  const parts  = [];

  function resize() { canvas.width = innerWidth; canvas.height = innerHeight; }
  resize();
  addEventListener('resize', resize);

  for (let i = 0; i < 22; i++) {
    parts.push({
      x:    Math.random() * innerWidth,
      y:    Math.random() * innerHeight,
      suit: suits[Math.floor(Math.random() * 4)],
      sz:   11 + Math.random() * 18,
      spd:  0.28 + Math.random() * 0.55,
      op:   0.08 + Math.random() * 0.22,
      rot:  Math.random() * Math.PI * 2,
      rs:   (Math.random() - 0.5) * 0.018,
      red:  Math.random() > 0.5,
    });
  }

  function frame() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (const p of parts) {
      p.y  -= p.spd;
      p.rot += p.rs;
      if (p.y < -40) { p.y = canvas.height + 40; p.x = Math.random() * canvas.width; }
      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot);
      ctx.font = `${p.sz}px serif`;
      ctx.fillStyle = p.red
        ? `rgba(204,26,26,${p.op})`
        : `rgba(201,168,76,${p.op})`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(p.suit, 0, 0);
      ctx.restore();
    }
    requestAnimationFrame(frame);
  }
  frame();
})();
</script>
</body>
</html>
